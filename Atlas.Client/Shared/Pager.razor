@* Based on: https://www.thecodehubs.com/visual-studio-blazor-template-with-dapper-and-net-core-3-1/*@

<nav aria-label="Pager">
    <ul class="pagination">
        <li class="page-item">
            <button class="btn btn-link page-link" role="link" @onclick=@(async () => await RefreshDataAsync(1))>First</button>
        </li>
        <li class="page-item">
            <button class="btn btn-link page-link" role="link" @onclick=@(async () => await NavigateToPage("previous"))>Previous</button>
        </li>
        @for (var i = _startPage; i <= _endPage; i++)
        {
            var currentPage = i;
            <li class="page-item @(currentPage==CurrentPage ? "active" : "")">
                <button class="btn btn-link page-link" role="link" @onclick=@(async () => await RefreshDataAsync(currentPage))>@currentPage</button>
            </li>
        }
        <li class="page-item">
            <button class="btn btn-link page-link" role="link" @onclick=@(async () => await NavigateToPage("next"))>Next</button>
        </li>
        <li class="page-item">
            <button class="btn btn-link page-link" role="link" @onclick=@(async () => await RefreshDataAsync(TotalPages))>Last</button>
        </li>
    </ul>
</nav>

@code {
    [Parameter]
    public int TotalPages { get; set; }

    [Parameter]
    public int CurrentPage { get; set; } = 1;

    [Parameter]
    public EventCallback<int> OnLoadDataCallback { get; set; }

    private const int PagerSize = 10;

    private int _startPage;
    private int _endPage;

    protected override void OnParametersSet()
    {
        Set_pagerSize("forward");
    }

    public async Task RefreshDataAsync(int page)
    {
        await OnLoadDataCallback.InvokeAsync(page);
        CurrentPage = page;
        StateHasChanged();
    }

    public void Set_pagerSize(string direction)
    {
        if (direction == "forward" && _endPage < TotalPages)
        {
            _startPage = _endPage + 1;
            if (_endPage + PagerSize < TotalPages)
            {
                _endPage = _startPage + PagerSize - 1;
            }
            else
            {
                _endPage = TotalPages;
            }
            StateHasChanged();
        }
        else if (direction == "back" && _startPage > 1)
        {
            _endPage = _startPage - 1;
            _startPage = _startPage - PagerSize;
        }
        else
        {
            _startPage = 1;
            _endPage = TotalPages;
        }
    }

    public async Task NavigateToPage(string direction)
    {
        if (direction == "next")
        {
            if (CurrentPage < TotalPages)
            {
                if (CurrentPage == _endPage)
                {
                    Set_pagerSize("forward");
                }
                CurrentPage += 1;
            }
        }
        else if (direction == "previous")
        {
            if (CurrentPage > 1)
            {
                if (CurrentPage == _startPage)
                {
                    Set_pagerSize("back");
                }
                CurrentPage -= 1;
            }
        }

        await RefreshDataAsync(CurrentPage);
    }
}
